---
title: Procedure consigliate per OpenXR
description: Informazioni sulle procedure consigliate per la qualità visiva, la stabilità e le prestazioni delle applicazioni OpenXR.
author: thetuvix
ms.author: alexturn
ms.date: 2/28/2020
ms.topic: article
keywords: OpenXR, Khronos, BasicXRApp, DirectX, nativo, app nativa, motore personalizzato, middleware, procedure consigliate, prestazioni, qualità, stabilità
ms.openlocfilehash: dad4622e4186ecc8b090e2abe2e33d3d39ac7525
ms.sourcegitcommit: 09599b4034be825e4536eeb9566968afd021d5f3
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/03/2020
ms.locfileid: "91683884"
---
# <a name="openxr-app-best-practices"></a><span data-ttu-id="37a8e-104">Procedure consigliate per le app OpenXR</span><span class="sxs-lookup"><span data-stu-id="37a8e-104">OpenXR app best practices</span></span>

<span data-ttu-id="37a8e-105">È possibile vedere un esempio delle procedure consigliate riportate di seguito nel file OpenXRProgram. cpp di <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>.</span><span class="sxs-lookup"><span data-stu-id="37a8e-105">You can see an example of the best practices below in <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>'s OpenXRProgram.cpp file.</span></span> <span data-ttu-id="37a8e-106">La funzione Run () all'inizio acquisisce un flusso di codice dell'app OpenXR tipico dall'inizializzazione all'evento e al ciclo di rendering.</span><span class="sxs-lookup"><span data-stu-id="37a8e-106">The Run() function at the beginning captures a typical OpenXR app code flow from initialization to the event and rendering loop.</span></span>

## <a name="best-practices-for-visual-quality-and-stability"></a><span data-ttu-id="37a8e-107">Procedure consigliate per la qualità e la stabilità visive</span><span class="sxs-lookup"><span data-stu-id="37a8e-107">Best practices for visual quality and stability</span></span>

<span data-ttu-id="37a8e-108">Le procedure consigliate in questa sezione descrivono come ottenere la qualità visiva e la stabilità migliori in qualsiasi applicazione OpenXR.</span><span class="sxs-lookup"><span data-stu-id="37a8e-108">The best practices in this section describe how to get the best visual quality and stability in any OpenXR application.</span></span>

<span data-ttu-id="37a8e-109">Per ulteriori raccomandazioni sulle prestazioni specifiche per HoloLens 2, vedere la sezione procedure consigliate [per le prestazioni in HoloLens 2](#best-practices-for-performance-on-hololens-2) .</span><span class="sxs-lookup"><span data-stu-id="37a8e-109">For further performance recommendations specific to HoloLens 2, see the [Best practices for performance on HoloLens 2](#best-practices-for-performance-on-hololens-2) section below.</span></span>

### <a name="gamma-correct-rendering"></a><span data-ttu-id="37a8e-110">Rendering con correzione gamma</span><span class="sxs-lookup"><span data-stu-id="37a8e-110">Gamma-correct rendering</span></span>

<span data-ttu-id="37a8e-111">È necessario prestare attenzione per assicurarsi che la pipeline di rendering sia corretta da gamma.</span><span class="sxs-lookup"><span data-stu-id="37a8e-111">Care must be taken to ensure that your rendering pipeline is gamma-correct.</span></span> <span data-ttu-id="37a8e-112">Quando si esegue il rendering in un presentazione catena, il formato di visualizzazione della destinazione di rendering deve corrispondere al formato presentazione catena, ad esempio `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` per il formato presentazione catena e la visualizzazione di destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="37a8e-112">When rendering to a swapchain, the render-target view format should match the swapchain format (e.g. `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` for both the swapchain format and the render-target view).</span></span>
<span data-ttu-id="37a8e-113">L'eccezione si verifica se la pipeline di rendering dell'app esegue una conversione manuale di sRGB nel codice dello shader, nel qual caso l'app deve richiedere un formato presentazione catena di sRGB, ma usare il formato lineare per la visualizzazione di destinazione di rendering (ad esempio, la richiesta `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` come formato presentazione catena ma usare `DXGI_FORMAT_B8G8R8A8_UNORM` come visualizzazione di destinazione di rendering) per impedire che il contenuto venga corretto a seconda della gamma.</span><span class="sxs-lookup"><span data-stu-id="37a8e-113">The exception is if the app's rendering pipeline does a manual sRGB conversion in shader code, in which case the app should request an sRGB swapchain format but use the linear format for the render-target view (e.g. request `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` as the swapchain format but use `DXGI_FORMAT_B8G8R8A8_UNORM` as the render-target view) to prevent content from being double-gamma corrected.</span></span>

### <a name="submit-depth-buffer-for-projection-layers"></a><span data-ttu-id="37a8e-114">Invia buffer di profondità per i livelli di proiezione</span><span class="sxs-lookup"><span data-stu-id="37a8e-114">Submit depth buffer for projection layers</span></span>

<span data-ttu-id="37a8e-115">Usare sempre `XR_KHR_composition_layer_depth` Extension e inviare il buffer di profondità insieme al livello di proiezione quando si invia un frame a `xrEndFrame` .</span><span class="sxs-lookup"><span data-stu-id="37a8e-115">Always use `XR_KHR_composition_layer_depth` extension and submit the depth buffer together with the projection layer when submitting a frame to `xrEndFrame`.</span></span>
<span data-ttu-id="37a8e-116">Ciò migliora la stabilità dell'ologramma abilitando la riproiezione hardware depth in HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="37a8e-116">This improves hologram stability by enabling hardware depth reprojection on HoloLens 2.</span></span>

### <a name="choose-a-reasonable-depth-range"></a><span data-ttu-id="37a8e-117">Scegliere un intervallo di profondità ragionevole</span><span class="sxs-lookup"><span data-stu-id="37a8e-117">Choose a reasonable depth range</span></span>

<span data-ttu-id="37a8e-118">Preferire un intervallo di profondità più ristretto per definire l'ambito del contenuto virtuale per aiutare la stabilità degli ologrammi in HoloLens.</span><span class="sxs-lookup"><span data-stu-id="37a8e-118">Prefer a narrower depth range to scope the virtual content to help hologram stability on HoloLens.</span></span>
<span data-ttu-id="37a8e-119">Ad esempio, l'esempio OpenXrProgram. cpp utilizza 0,1 a 20 metri.</span><span class="sxs-lookup"><span data-stu-id="37a8e-119">For example, the OpenXrProgram.cpp sample is using 0.1 to 20 meters.</span></span>
<span data-ttu-id="37a8e-120">Utilizzare [invertito-Z](https://developer.nvidia.com/content/depth-precision-visualized) per una risoluzione più uniforme della profondità.</span><span class="sxs-lookup"><span data-stu-id="37a8e-120">Use [reversed-Z](https://developer.nvidia.com/content/depth-precision-visualized) for a more uniform depth resolution.</span></span>
<span data-ttu-id="37a8e-121">Si noti che, in HoloLens 2, l'uso del `DXGI_FORMAT_D16_UNORM` formato di profondità preferito consentirà di ottimizzare la frequenza dei fotogrammi e le prestazioni, sebbene i buffer di profondità a 16 bit forniscano una risoluzione meno approfondita rispetto ai buffer di profondità a 24 bit.</span><span class="sxs-lookup"><span data-stu-id="37a8e-121">Note that, on HoloLens 2, using the preferred `DXGI_FORMAT_D16_UNORM` depth format will help achieve better frame rate and performance, although 16-bit depth buffers provide less depth resolution than 24-bit depth buffers.</span></span>
<span data-ttu-id="37a8e-122">Quindi, seguendo queste procedure consigliate per sfruttare al meglio la risoluzione di profondità diventa più importante.</span><span class="sxs-lookup"><span data-stu-id="37a8e-122">Therefore, following these best practices to make best use of the depth resolution becomes more important.</span></span>

### <a name="prepare-for-different-environment-blend-modes"></a><span data-ttu-id="37a8e-123">Preparare le diverse modalità di Blend dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="37a8e-123">Prepare for different environment blend modes</span></span>

<span data-ttu-id="37a8e-124">Se l'applicazione verrà eseguita anche su auricolari immersivi che bloccano completamente il mondo, assicurarsi di enumerare le modalità di Blend dell'ambiente supportate usando l' `xrEnumerateEnvironmentBlendModes` API e di preparare il contenuto di rendering di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="37a8e-124">If your application will also run on immersive headsets that completely block out the world, be sure to enumerate supported environment blend modes using `xrEnumerateEnvironmentBlendModes` API, and prepare your rendering content accordingly.</span></span>
<span data-ttu-id="37a8e-125">Ad esempio, per un sistema con come `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` HoloLens, l'app deve usare trasparente come colore chiaro, mentre per un sistema con `XR_ENVIRONMENT_BLEND_MODE_OPAQUE` , l'app deve eseguire il rendering di un colore opaco o di una stanza virtuale in background.</span><span class="sxs-lookup"><span data-stu-id="37a8e-125">For example, for a system with `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` such as the HoloLens, the app should use transparent as the clear color, while for a system with `XR_ENVIRONMENT_BLEND_MODE_OPAQUE`, the app should render some opaque color or some virtual room in the background.</span></span>

### <a name="choose-unbounded-reference-space-as-applications-root-space"></a><span data-ttu-id="37a8e-126">Scegliere lo spazio di riferimento senza limiti come spazio radice dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="37a8e-126">Choose unbounded reference space as application's root space</span></span>

<span data-ttu-id="37a8e-127">In genere, le applicazioni stabiliscono uno spazio delle coordinate del mondo radice per connettere viste, azioni e ologrammi.</span><span class="sxs-lookup"><span data-stu-id="37a8e-127">Applications typically establish some root world coordinate space to connect views, actions and holograms together.</span></span>
<span data-ttu-id="37a8e-128">Usare `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` quando l'estensione è supportata per stabilire un [sistema di coordinate su scala globale](../../design/coordinate-systems.md#building-a-world-scale-experience), consentendo all'app di evitare la tendenza olografica indesiderata quando l'utente si sposta lontano (ad esempio, 5 metri di distanza) da dove viene avviata l'app.</span><span class="sxs-lookup"><span data-stu-id="37a8e-128">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` when the extension is supported to establish a [world-scale coordinate system](../../design/coordinate-systems.md#building-a-world-scale-experience), enabling your app to avoid undesired hologram drift when the user moves far (e.g. 5 meters away) from where the app starts.</span></span>
<span data-ttu-id="37a8e-129">Utilizzare `XR_REFERENCE_SPACE_TYPE_LOCAL` come fallback se l'estensione dello spazio non associato non esiste.</span><span class="sxs-lookup"><span data-stu-id="37a8e-129">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` as a fallback if the unbounded space extension doesn't exist.</span></span>

### <a name="associate-hologram-with-spatial-anchor"></a><span data-ttu-id="37a8e-130">Associa ologramma a ancoraggio spaziale</span><span class="sxs-lookup"><span data-stu-id="37a8e-130">Associate hologram with spatial anchor</span></span>

<span data-ttu-id="37a8e-131">Quando si usa uno spazio di riferimento non vincolato, gli ologrammi posizionati direttamente nello spazio di riferimento [potrebbero andare alla deriva quando l'utente passa a una stanza lontana e quindi](../../design/coordinate-systems.md#building-a-world-scale-experience)torna.</span><span class="sxs-lookup"><span data-stu-id="37a8e-131">When using an unbounded reference space, holograms you place directly in that reference space [may drift as the user walks to distant rooms and then comes back](../../design/coordinate-systems.md#building-a-world-scale-experience).</span></span>
<span data-ttu-id="37a8e-132">Per gli utenti olografici posizionati in una posizione discreta nel mondo, [creare un ancoraggio spaziale](../../design/spatial-anchors.md#best-practices) usando la `xrCreateSpatialAnchorSpaceMSFT` funzione di estensione e posizionare l'ologramma all'origine.</span><span class="sxs-lookup"><span data-stu-id="37a8e-132">For hologram users place at a discrete location in the world, [create a spatial anchor](../../design/spatial-anchors.md#best-practices) using the `xrCreateSpatialAnchorSpaceMSFT` extension function and position the hologram at its origin.</span></span>
<span data-ttu-id="37a8e-133">In questo modo l'ologramma viene mantenuto indipendentemente stabile nel tempo.</span><span class="sxs-lookup"><span data-stu-id="37a8e-133">That will keep that hologram independently stable over time.</span></span>

### <a name="support-mixed-reality-capture"></a><span data-ttu-id="37a8e-134">Supportare l'acquisizione di realtà mista</span><span class="sxs-lookup"><span data-stu-id="37a8e-134">Support mixed reality capture</span></span>

<span data-ttu-id="37a8e-135">Sebbene la visualizzazione principale di HoloLens 2 usi la fusione dell'ambiente additiva, quando l'utente avvia l' [acquisizione della realtà mista](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), il contenuto di rendering dell'app verrà sottoposto ad Alpha blending con il flusso video dell'ambiente.</span><span class="sxs-lookup"><span data-stu-id="37a8e-135">Although HoloLens 2's primary display uses additive environment blending, when the user initiates [mixed reality capture](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), the app's rendering content will be alpha-blended with the environment video stream.</span></span>
<span data-ttu-id="37a8e-136">Per ottenere la migliore qualità visiva nei video di acquisizione di realtà mista, è preferibile impostare nell'oggetto del `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` livello di proiezione `layerFlags` .</span><span class="sxs-lookup"><span data-stu-id="37a8e-136">To achieve the best visual quality in mixed reality capture videos, it's best to set the `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` in your projection layer's `layerFlags`.</span></span>

## <a name="best-practices-for-performance-on-hololens-2"></a><span data-ttu-id="37a8e-137">Procedure consigliate per le prestazioni in HoloLens 2</span><span class="sxs-lookup"><span data-stu-id="37a8e-137">Best practices for performance on HoloLens 2</span></span>

<span data-ttu-id="37a8e-138">Come dispositivo mobile con supporto per la riproiezione dell'hardware, HoloLens 2 presenta requisiti più restrittivi per ottenere prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="37a8e-138">As a mobile device with hardware reprojection support, HoloLens 2 has stricter requirements to obtain optimal performance.</span></span>  <span data-ttu-id="37a8e-139">Esistono diversi modi per inviare i dati di composizione tramite, che comporteranno `xrEndFrame` una successiva elaborazione che avrà una notevole riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="37a8e-139">There are a number of ways to submit composition data through `xrEndFrame` which will result in post-processing that will have a noticeable performance penalty.</span></span>

### <a name="select-a-swapchain-format"></a><span data-ttu-id="37a8e-140">Selezionare un formato presentazione catena</span><span class="sxs-lookup"><span data-stu-id="37a8e-140">Select a swapchain format</span></span>

<span data-ttu-id="37a8e-141">Enumerare sempre i formati di pixel supportati usando `xrEnumerateSwapchainFormats` e scegliere il primo formato pixel di colore e profondità dal runtime supportato dall'app, perché questo è quello che il runtime preferisce per ottenere prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="37a8e-141">Always enumerate supported pixel formats using `xrEnumerateSwapchainFormats`, and choose the first color and depth pixel format from the runtime that the app supports, because that's what the runtime prefers for optimal performance.</span></span> <span data-ttu-id="37a8e-142">Si noti che, in HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` ed `DXGI_FORMAT_D16_UNORM` è in genere la prima scelta per ottenere prestazioni di rendering migliori.</span><span class="sxs-lookup"><span data-stu-id="37a8e-142">Note, on HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` and `DXGI_FORMAT_D16_UNORM` is typically the first choice to achieve better rendering performance.</span></span> <span data-ttu-id="37a8e-143">Questa preferenza può essere diversa negli auricolari VR in esecuzione su un PC desktop, in cui i buffer di profondità a 24 bit hanno un minore effetto sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="37a8e-143">This preference can be different on VR headsets running on a Desktop PC, where 24-bit depth buffers have less of a performance impact.</span></span>
  
<span data-ttu-id="37a8e-144">**Avviso di prestazioni:** Se si usa un formato diverso dal formato di colore presentazione catena primario, la post-elaborazione del runtime comporterà una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="37a8e-144">**Performance Warning:** Using a format other than the primary swapchain color format will result in runtime post-processing which comes at a significant performance penalty.</span></span>

### <a name="render-with-recommended-rendering-parameters-and-frame-timing"></a><span data-ttu-id="37a8e-145">Rendering con i parametri di rendering consigliati e la tempistica dei frame</span><span class="sxs-lookup"><span data-stu-id="37a8e-145">Render with recommended rendering parameters and frame timing</span></span>

<span data-ttu-id="37a8e-146">Eseguire sempre il rendering con la larghezza/altezza di configurazione della visualizzazione consigliata ( `recommendedImageRectWidth` e `recommendedImageRectHeight` da `XrViewConfigurationView` ) e usare sempre l' `xrLocateViews` API per eseguire una query per la visualizzazione, FOV e altri parametri di rendering consigliati prima del rendering.</span><span class="sxs-lookup"><span data-stu-id="37a8e-146">Always render with the recommended view configuration width/height (`recommendedImageRectWidth` and `recommendedImageRectHeight` from `XrViewConfigurationView`), and always use `xrLocateViews` API to query for the recommended view pose, fov, and other rendering parameters before rendering.</span></span>
<span data-ttu-id="37a8e-147">Usare sempre `XrFrameEndInfo.predictedDisplayTime` dalla chiamata più recente `xrWaitFrame` quando si eseguono query per pose e viste.</span><span class="sxs-lookup"><span data-stu-id="37a8e-147">Always use the `XrFrameEndInfo.predictedDisplayTime` from the latest `xrWaitFrame` call when querying for poses and views.</span></span>
<span data-ttu-id="37a8e-148">Ciò consente a HoloLens di modificare il rendering e ottimizzare la qualità visiva per la persona che sta indossando la HoloLens.</span><span class="sxs-lookup"><span data-stu-id="37a8e-148">This allows HoloLens to adjust rendering and optimize visual quality for the person who is wearing the HoloLens.</span></span>

### <a name="use-a-single-projection-layer"></a><span data-ttu-id="37a8e-149">Usa un solo livello di proiezione</span><span class="sxs-lookup"><span data-stu-id="37a8e-149">Use a single projection layer</span></span>

<span data-ttu-id="37a8e-150">HoloLens 2 ha una potenza GPU limitata per le applicazioni per il rendering del contenuto e un compositor hardware ottimizzato per un singolo livello di proiezione.</span><span class="sxs-lookup"><span data-stu-id="37a8e-150">HoloLens 2 has limited GPU power for applications to render content and a hardware compositor optimized for a single projection layer.</span></span>
<span data-ttu-id="37a8e-151">Usare sempre un solo livello di proiezione può aiutare a framerate, stabilità olografica e qualità visiva dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="37a8e-151">Always using a single projection layer can help the application's framerate, hologram stability and visual quality.</span></span>  
  
<span data-ttu-id="37a8e-152">**Avviso di prestazioni:** L'invio di un singolo livello di protezione comporta un conseguente calo delle prestazioni in fase di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="37a8e-152">**Performance Warning:** Submitting anything but a single protection layer will result in runtime post-processing which comes at a significant performance penalty.</span></span>

### <a name="render-with-texture-array-and-vprt"></a><span data-ttu-id="37a8e-153">Rendering con matrice di trame e VPRT</span><span class="sxs-lookup"><span data-stu-id="37a8e-153">Render with texture array and VPRT</span></span>

<span data-ttu-id="37a8e-154">Crearne uno `xrSwapchain` per gli occhi sinistro e destro usando `arraySize=2` per il colore presentazione catena e uno per la profondità.</span><span class="sxs-lookup"><span data-stu-id="37a8e-154">Create one `xrSwapchain` for both left and right eye using `arraySize=2` for color swapchain, and one for depth.</span></span>
<span data-ttu-id="37a8e-155">Eseguire il rendering dell'occhio sinistro nella sezione 0 e l'occhio destro nella sezione 1.</span><span class="sxs-lookup"><span data-stu-id="37a8e-155">Render the left eye into slice 0 and the right eye into slice 1.</span></span>
<span data-ttu-id="37a8e-156">Usare uno shader con VPRT e le chiamate di progetto con istanza per il rendering stereoscopico per ridurre al minimo il carico della GPU.</span><span class="sxs-lookup"><span data-stu-id="37a8e-156">Use a shader with VPRT and instanced draw calls for stereoscopic rendering to minimize GPU load.</span></span>
<span data-ttu-id="37a8e-157">Questo consente anche l'ottimizzazione del runtime per ottenere prestazioni ottimali in HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="37a8e-157">This also enables the runtime's optimization to achieve the best performance on HoloLens 2.</span></span>
<span data-ttu-id="37a8e-158">Le alternative all'uso di una matrice di trame, ad esempio il rendering a doppio livello o un presentazione catena separato per occhio, comporteranno una successiva elaborazione del runtime che comporta una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="37a8e-158">Alternatives to using a texture array, such as double-wide rendering or a separate swapchain per eye, will result in runtime post-processing which comes at a significant performance penalty.</span></span>

### <a name="avoid-quad-layers"></a><span data-ttu-id="37a8e-159">Evitare i livelli quad</span><span class="sxs-lookup"><span data-stu-id="37a8e-159">Avoid quad layers</span></span>

<span data-ttu-id="37a8e-160">Anziché inviare livelli quad come livelli di composizione con `XrCompositionLayerQuad` , eseguire il rendering del contenuto Quad direttamente nella proiezione presentazione catena.</span><span class="sxs-lookup"><span data-stu-id="37a8e-160">Rather than submitting quad layers as composition layers with `XrCompositionLayerQuad`, render the quad content directly into the projection swapchain.</span></span>

<span data-ttu-id="37a8e-161">**Avviso di prestazioni:** Fornire livelli aggiuntivi oltre un singolo livello di proiezione, ad esempio i livelli quad, comporterà la post-elaborazione in fase di esecuzione, che comporta una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="37a8e-161">**Performance Warning:** Providing additional layers beyond a single projection layer, such as quad layers, will result in runtime post-processing which comes at a significant performance penalty.</span></span>